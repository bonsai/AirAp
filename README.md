# AI Rapper - æ­Œè©ç”Ÿæˆãƒ»ä½œæ›²ãƒ»MP3å‡ºåŠ›çµ±åˆã‚·ã‚¹ãƒ†ãƒ 

æ­Œè©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå—ä¿¡ â†’ AIæ­Œè©ç”Ÿæˆï¼ˆrinna/YuE GGUFï¼‰ â†’ ä½œæ›² â†’ MP3å‡ºåŠ›ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [æ©Ÿèƒ½](#æ©Ÿèƒ½)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [GGUFãƒ¢ãƒ‡ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ggufãƒ¢ãƒ‡ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [APIä½¿ç”¨æ–¹æ³•](#apiä½¿ç”¨æ–¹æ³•)
- [ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶](#ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [é–‹ç™ºã‚¬ã‚¤ãƒ‰](#é–‹ç™ºã‚¬ã‚¤ãƒ‰)
- [å‚è€ƒãƒªãƒ³ã‚¯](#å‚è€ƒãƒªãƒ³ã‚¯)

## æ¦‚è¦

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒ†ãƒ¼ãƒã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‹ã‚‰æ­Œè©ã‚’è‡ªå‹•ç”Ÿæˆã—ã€ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ã¨ãƒªã‚ºãƒ ã‚’ç”Ÿæˆã—ã¦MP3ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹AIãƒ©ãƒƒãƒ‘ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Kaggleç’°å¢ƒã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«æœ€é©åŒ–ã•ã‚Œã¦ãŠã‚Šã€rinnaï¼ˆæ—¥æœ¬èªï¼‰ã¨YuEï¼ˆè‹±èªï¼‰ã®GGUFãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦é«˜å“è³ªãªæ­Œè©ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

## æ©Ÿèƒ½

- âœ… **AIæ­Œè©ç”Ÿæˆ**: rinna/YuEã®GGUFãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ãŸé«˜å“è³ªãªæ­Œè©ç”Ÿæˆ
- âœ… **ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç”Ÿæˆ**: AIä¸ä½¿ç”¨æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- âœ… **éŸ³æ¥½ç”Ÿæˆ**: æ­Œè©ã‹ã‚‰ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ã¨ãƒªã‚ºãƒ ã‚’è‡ªå‹•ç”Ÿæˆ
- âœ… **MP3å‡ºåŠ›**: å®Œæˆã—ãŸæ¥½æ›²ã‚’MP3å½¢å¼ã§å‡ºåŠ›
- âœ… **RESTful API**: FastAPIãƒ™ãƒ¼ã‚¹ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- âœ… **ãƒ¢ãƒ‡ãƒ«é¸æŠ**: æ—¥æœ¬èªï¼ˆrinnaï¼‰ã¨è‹±èªï¼ˆYuEï¼‰ã®ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠå¯èƒ½

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
cd ai_rapper
docker build -f Dockerfile.kaggle -t ai-rapper-kaggle .
```

### 2. ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```bash
# docker-composeã‚’ä½¿ç”¨
docker-compose up -d

# ã¾ãŸã¯æ‰‹å‹•ã§
docker run -d -p 8000:8000 -v $(pwd)/output:/app/output ai-rapper-kaggle
```

### 3. APIã®ç¢ºèª

ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹:
- **Web UI**: http://localhost:8000/ui
- **APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: http://localhost:8000/docs
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: http://localhost:8000/

### 4. æœ€åˆã®æ¥½æ›²ã‚’ç”Ÿæˆ

```bash
curl -X POST "http://localhost:8000/compose" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": {
      "theme": "love",
      "style": "rap",
      "model": "yue",
      "use_ai": true,
      "bpm": 120,
      "key": "C"
    }
  }'
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ `download_url` ã‚’å–å¾—ã—ã¦ã€MP3ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:

```bash
curl -O "http://localhost:8000/download/song_xxxxx.mp3"
```

### 5. Pythonã‹ã‚‰ç›´æ¥ä½¿ç”¨

```python
import requests

# æ¥½æ›²ç”Ÿæˆ
response = requests.post(
    "http://localhost:8000/compose",
    json={
        "prompt": {
            "theme": "party",
            "style": "rap",
            "model": "yue",
            "use_ai": true,
            "bpm": 140
        }
    }
)

result = response.json()
print(f"Generated: {result['filename']}")

# MP3ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
mp3 = requests.get(f"http://localhost:8000{result['download_url']}")
with open(result['filename'], 'wb') as f:
    f.write(mp3.content)
```

## GGUFãƒ¢ãƒ‡ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¯¾å¿œãƒ¢ãƒ‡ãƒ«

#### YuE (è‹±èªãƒ¢ãƒ‡ãƒ«)
- **ãƒ¢ãƒ‡ãƒ«å**: YuE-s1-7B
- **å½¢å¼**: GGUF
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹**: `/app/yue/Models/YuE/*.gguf`
- **ç’°å¢ƒå¤‰æ•°**: `YUE_MODEL_PATH`
- **æ¨å¥¨é‡å­åŒ–**: Q6_K
- **ãƒ¡ãƒ¢ãƒª**: ç´„6-8GB
- **ç”¨é€”**: è‹±èªã®æ­Œè©ç”Ÿæˆ

#### rinna (æ—¥æœ¬èªãƒ¢ãƒ‡ãƒ«)
- **ãƒ¢ãƒ‡ãƒ«å**: rinna/japanese-gpt2-medium (GGUFå½¢å¼)
- **å½¢å¼**: GGUF
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹**: `/app/rin/models/*.gguf` ã¾ãŸã¯ `/app/rinna/models/*.gguf`
- **ç’°å¢ƒå¤‰æ•°**: `RINNA_MODEL_PATH`
- **æ¨å¥¨é‡å­åŒ–**: Q4_0ã¾ãŸã¯Q6_K
- **ãƒ¡ãƒ¢ãƒª**: ç´„4-8GB
- **ç”¨é€”**: æ—¥æœ¬èªã®æ­Œè©ç”Ÿæˆ

### ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

#### YuEãƒ¢ãƒ‡ãƒ«

æ—¢ã« `yue/Models/YuE/` ã«ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€ãã®ã¾ã¾ä½¿ç”¨ã§ãã¾ã™ã€‚

æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆ:

```bash
# Hugging Faceã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
# https://huggingface.co/Aryanne/YuE-s1-7B-anneal-en-cot-Q6_K-GGUF
```

#### rinnaãƒ¢ãƒ‡ãƒ«

rinnaãƒ¢ãƒ‡ãƒ«ã®GGUFå½¢å¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:

```bash
# ä¾‹: mmnga/rinna-youri-7b-gguf
# https://huggingface.co/mmnga/rinna-youri-7b-gguf
```

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `/app/rin/models/` ã¾ãŸã¯ `/app/rinna/models/` ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚

### ç’°å¢ƒå¤‰æ•°ã§ãƒ‘ã‚¹ã‚’æŒ‡å®š

Dockerç’°å¢ƒã§ãƒ¢ãƒ‡ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®š:

```bash
docker run -d -p 8000:8000 \
  -e YUE_MODEL_PATH=/path/to/yue.gguf \
  -e RINNA_MODEL_PATH=/path/to/rinna.gguf \
  -v $(pwd)/output:/app/output \
  ai-rapper-kaggle
```

### ãƒ¢ãƒ‡ãƒ«ã®ç¢ºèª

```python
from app.gguf_loader import get_loader

loader = get_loader()
print(loader.model_paths)  # åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¤º
```

## APIä½¿ç”¨æ–¹æ³•

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---------|--------------|------|
| GET | `/` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ»åˆ©ç”¨å¯èƒ½ãƒ¢ãƒ‡ãƒ«è¡¨ç¤º |
| POST | `/generate` | æ­Œè©ã‚’ç”Ÿæˆ |
| POST | `/compose` | æ­Œè©ç”Ÿæˆâ†’ä½œæ›²â†’MP3å‡ºåŠ› |
| GET | `/download/{filename}` | MP3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ |
| GET | `/list` | ç”Ÿæˆã•ã‚ŒãŸMP3ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆ |

### 1. æ­Œè©ç”Ÿæˆã®ã¿

#### YuEãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ï¼ˆè‹±èªï¼‰

```bash
curl -X POST "http://localhost:8000/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "theme": "love",
    "style": "rap",
    "model": "yue",
    "use_ai": true,
    "bpm": 120,
    "key": "C"
  }'
```

#### rinnaãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ï¼ˆæ—¥æœ¬èªï¼‰

```bash
curl -X POST "http://localhost:8000/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "theme": "æ„›",
    "style": "rap",
    "model": "rinna",
    "use_ai": true,
    "bpm": 120,
    "key": "C"
  }'
```

#### ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç”Ÿæˆï¼ˆAIä¸ä½¿ç”¨ï¼‰

```bash
curl -X POST "http://localhost:8000/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "theme": "love",
    "style": "rap",
    "use_ai": false
  }'
```

### 2. æ­Œè©ç”Ÿæˆ + ä½œæ›² + MP3å‡ºåŠ›

```bash
curl -X POST "http://localhost:8000/compose" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": {
      "theme": "party",
      "style": "rap",
      "model": "yue",
      "use_ai": true,
      "bpm": 140,
      "key": "Am"
    }
  }'
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
```json
{
  "status": "success",
  "filename": "song_abc12345.mp3",
  "download_url": "/download/song_abc12345.mp3",
  "metadata": {
    "title": "Party Song",
    "bpm": 140,
    "key": "Am"
  }
}
```

### 3. æ—¢å­˜ã®æ­Œè©ã‹ã‚‰ä½œæ›²

```bash
curl -X POST "http://localhost:8000/compose" \
  -H "Content-Type: application/json" \
  -d '{
    "lyrics": "Yo, this is my rap\nListen up, don'\''t look back\n",
    "output_filename": "my_song.mp3"
  }'
```

### 4. MP3ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

```bash
curl -O "http://localhost:8000/download/song_abc12345.mp3"
```

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### LyricPrompt

```json
{
  "theme": "love",           // ãƒ†ãƒ¼ãƒ: love, party, sad ãªã©
  "style": "rap",            // ã‚¹ã‚¿ã‚¤ãƒ«: rap, pop ãªã©
  "model": "yue",            // ãƒ¢ãƒ‡ãƒ«: "yue" ã¾ãŸã¯ "rinna"
  "use_ai": true,            // AIãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‹ï¼ˆtrue/falseï¼‰
  "custom_prompt": "string",  // ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  "bpm": 120,                // ãƒ†ãƒ³ãƒï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  "key": "C"                 // ã‚­ãƒ¼: C, D, Am ãªã©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
}
```

#### ComposeRequest

```json
{
  "lyrics": "string",        // ç›´æ¥æ­Œè©ã‚’æŒ‡å®šï¼ˆpromptã¨æ’ä»–çš„ï¼‰
  "prompt": { ... },         // æ­Œè©ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆlyricsã¨æ’ä»–çš„ï¼‰
  "output_filename": "string" // å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
}
```

### Kaggleç’°å¢ƒã§ã®ä½¿ç”¨

```python
import requests

# APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆKaggleç’°å¢ƒå†…ã®ã‚³ãƒ³ãƒ†ãƒŠï¼‰
API_URL = "http://localhost:8000"

# æ­Œè©ç”Ÿæˆã¨ä½œæ›²
response = requests.post(
    f"{API_URL}/compose",
    json={
        "prompt": {
            "theme": "love",
            "style": "rap",
            "model": "yue",
            "use_ai": true,
            "bpm": 120,
            "key": "C"
        }
    }
)

result = response.json()
print(f"Generated: {result['filename']}")

# MP3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
mp3_response = requests.get(f"{API_URL}{result['download_url']}")
with open(result['filename'], 'wb') as f:
    f.write(mp3_response.content)
```

## ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

- **OS**: Linux (Kaggleç’°å¢ƒå¯¾å¿œ)
- **Python**: 3.11+
- **RAM**: æœ€ä½4GBï¼ˆæ¨å¥¨8GBä»¥ä¸Šã€GGUFãƒ¢ãƒ‡ãƒ«ä½¿ç”¨æ™‚ã¯16GBä»¥ä¸Šæ¨å¥¨ï¼‰
- **ãƒ‡ã‚£ã‚¹ã‚¯**: æœ€ä½5GBã®ç©ºãå®¹é‡ï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å«ã‚€å ´åˆã¯10GBä»¥ä¸Šï¼‰

## ä¾å­˜é–¢ä¿‚

### ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- ffmpeg (éŸ³å£°å¤‰æ›)
- fluidsynth (MIDIâ†’WAVå¤‰æ›)
- timidity (MIDIå†ç”Ÿ)
- fluid-soundfont-gm (ã‚µã‚¦ãƒ³ãƒ‰ãƒ•ã‚©ãƒ³ãƒˆ)

### Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- FastAPI (Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)
- llama-cpp-python (GGUFãƒ¢ãƒ‡ãƒ«å®Ÿè¡Œ)
- music21 (MIDIå‡¦ç†)
- librosa (éŸ³å£°å‡¦ç†)
- pydub (éŸ³å£°å¤‰æ›)
- transformers, torch (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨)

è©³ç´°ã¯ `requirements.txt` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

1. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ç¢ºèª:
   ```python
   from app.gguf_loader import get_loader
   loader = get_loader()
   print(loader.model_paths)
   ```

2. ç’°å¢ƒå¤‰æ•°ã§ãƒ‘ã‚¹ã‚’æŒ‡å®š:
   ```bash
   export YUE_MODEL_PATH=/path/to/model.gguf
   export RINNA_MODEL_PATH=/path/to/rinna.gguf
   ```

### llama-cpp-pythonã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼

Kaggleç’°å¢ƒã§ã¯ã€äº‹å‰ã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸwheelã‚’ä½¿ç”¨:

```bash
# CPUç‰ˆ
pip install llama-cpp-python --extra-index-url https://abetlen.github.io/llama-cpp-python/whl/cpu

# GPUç‰ˆï¼ˆCUDA 12.1ï¼‰
pip install llama-cpp-python --extra-index-url https://abetlen.github.io/llama-cpp-python/whl/cu121
```

### ãƒ¡ãƒ¢ãƒªä¸è¶³

- ã‚ˆã‚Šä½ã„é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ï¼ˆQ4_0ï¼‰ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨
- `n_ctx`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸›ã‚‰ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2048ï¼‰
- `n_gpu_layers=0`ã§CPUã®ã¿ä½¿ç”¨
- ã‚ˆã‚Šå°ã•ãªãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨

### ç”Ÿæˆé€Ÿåº¦ãŒé…ã„

- GPUã‚’ä½¿ç”¨: `n_gpu_layers`ã‚’è¨­å®š
- é‡å­åŒ–ãƒ¬ãƒ™ãƒ«ã‚’ä¸‹ã’ã‚‹ï¼ˆQ4_0ãªã©ï¼‰
- `n_threads`ã‚’èª¿æ•´

### MIDIâ†’MP3å¤‰æ›ãŒå¤±æ•—ã™ã‚‹

1. fluidsynthãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª:
   ```bash
   which fluidsynth
   ```

2. ã‚µã‚¦ãƒ³ãƒ‰ãƒ•ã‚©ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª:
   ```bash
   ls /usr/share/sounds/sf2/
   ```

3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦timidityã‚’ä½¿ç”¨:
   - Dockerfileã§timidityã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

### APIãŒå¿œç­”ã—ãªã„

1. ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª:
   ```bash
   docker ps
   ```

2. ãƒ­ã‚°ã‚’ç¢ºèª:
   ```bash
   docker logs <container_id>
   # ã¾ãŸã¯
   docker-compose logs
   ```

### ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

```bash
# åˆ¥ã®ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨
docker run -d -p 8001:8000 ai-rapper-kaggle
```

## Web UI

### ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹:
- **Web UI**: http://localhost:8000/ui
- **APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: http://localhost:8000/docs

### UIæ©Ÿèƒ½

#### 1. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š
- **ãƒ†ãƒ¼ãƒ**: æ­Œè©ã®ãƒ†ãƒ¼ãƒã‚’é¸æŠï¼ˆLove, Party, Sad, Motivational, Lifeï¼‰
- **ã‚¹ã‚¿ã‚¤ãƒ«**: ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠï¼ˆRap, Popï¼‰
- **AIãƒ¢ãƒ‡ãƒ«**: ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠï¼ˆYuE: è‹±èª, rinna: æ—¥æœ¬èªï¼‰
- **AIä½¿ç”¨**: AIãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ç”Ÿæˆã‹ã‚’é¸æŠ
- **BPM**: ãƒ†ãƒ³ãƒã‚’è¨­å®šï¼ˆ60-200ï¼‰
- **ã‚­ãƒ¼**: éŸ³æ¥½ã®ã‚­ãƒ¼ã‚’é¸æŠ
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: è¿½åŠ ã®æŒ‡ç¤ºã‚„ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›

#### 2. æ­Œè©ç”Ÿæˆ
ã€Œæ­Œè©ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€è¨­å®šã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åŸºã¥ã„ã¦æ­Œè©ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

#### 3. ä½œæ›² + MP3å‡ºåŠ›
ã€Œæ­Œè©ç”Ÿæˆ + ä½œæ›² + MP3å‡ºåŠ›ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ï¼š
1. æ­Œè©ãŒç”Ÿæˆã•ã‚Œã‚‹
2. ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ã¨ãƒªã‚ºãƒ ãŒä½œæˆã•ã‚Œã‚‹
3. MP3ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
4. ãƒ–ãƒ©ã‚¦ã‚¶ã§å†ç”Ÿãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½

#### 4. ç›´æ¥æ­Œè©å…¥åŠ›
ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ç›´æ¥æ­Œè©ã‚’å…¥åŠ›ã—ã¦ã€ã€Œã“ã®æ­Œè©ã‹ã‚‰ä½œæ›²ã€ãƒœã‚¿ãƒ³ã§ä½œæ›²ã§ãã¾ã™ã€‚

#### 5. ç”Ÿæˆå±¥æ­´
ã€Œç”Ÿæˆæ¸ˆã¿æ¥½æ›²ä¸€è¦§ã€ãƒœã‚¿ãƒ³ã§ã€ã“ã‚Œã¾ã§ã«ç”Ÿæˆã—ãŸæ¥½æ›²ã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚„å†ç”ŸãŒã§ãã¾ã™ã€‚

### UIä½¿ç”¨ä¾‹

#### ä¾‹1: è‹±èªã®ãƒ©ãƒƒãƒ—ã‚’ç”Ÿæˆ
1. ãƒ†ãƒ¼ãƒ: "love"
2. ã‚¹ã‚¿ã‚¤ãƒ«: "rap"
3. AIãƒ¢ãƒ‡ãƒ«: "yue"
4. AIä½¿ç”¨: "æœ‰åŠ¹"
5. BPM: 120
6. ã€Œæ­Œè©ç”Ÿæˆ + ä½œæ›² + MP3å‡ºåŠ›ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

#### ä¾‹2: æ—¥æœ¬èªã®ãƒ©ãƒƒãƒ—ã‚’ç”Ÿæˆ
1. ãƒ†ãƒ¼ãƒ: "æ„›"ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¨˜å…¥ï¼‰
2. ã‚¹ã‚¿ã‚¤ãƒ«: "rap"
3. AIãƒ¢ãƒ‡ãƒ«: "rinna"
4. AIä½¿ç”¨: "æœ‰åŠ¹"
5. ã€Œæ­Œè©ç”Ÿæˆ + ä½œæ›² + MP3å‡ºåŠ›ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

#### ä¾‹3: æ—¢å­˜ã®æ­Œè©ã‹ã‚‰ä½œæ›²
1. ã€Œç›´æ¥æ­Œè©ã‚’å…¥åŠ›ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«æ­Œè©ã‚’å…¥åŠ›
2. ã€Œã“ã®æ­Œè©ã‹ã‚‰ä½œæ›²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

## é–‹ç™ºã‚¬ã‚¤ãƒ‰

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

```bash
# ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
python app/main.py
```

### ãƒ†ã‚¹ãƒˆ

```bash
# APIãƒ†ã‚¹ãƒˆ
curl http://localhost:8000/

# æ­Œè©ç”Ÿæˆãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:8000/generate \
  -H "Content-Type: application/json" \
  -d '{"theme": "love", "style": "rap", "model": "yue", "use_ai": true}'

# ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
python -m pytest tests/
# ã¾ãŸã¯
python tests/test_api.py
```

### ã‚³ãƒ¼ãƒ‰ä¾‹: GGUFãƒ¢ãƒ‡ãƒ«ã®ç›´æ¥ä½¿ç”¨

```python
from app.gguf_loader import generate_with_gguf, get_loader

# ç°¡æ˜“é–¢æ•°ã‚’ä½¿ç”¨
lyrics = generate_with_gguf(
    prompt="Generate rap lyrics about love",
    model_name="yue",
    max_tokens=512,
    temperature=0.8
)

# ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ç›´æ¥ä½¿ç”¨
loader = get_loader()
model = loader.load_model("yue", n_ctx=2048, n_gpu_layers=0)
text = loader.generate(
    "Generate lyrics",
    model_name="yue",
    max_tokens=256
)
```

### ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢

```bash
docker-compose down
# ã¾ãŸã¯
docker stop ai-rapper-kaggle
```

### ãƒ†ã‚¹ãƒˆ

ãƒ†ã‚¹ãƒˆã¯ `tests/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚Šã¾ã™:

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
python -m pytest tests/

# å€‹åˆ¥ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
python tests/test_api.py
python tests/test_generator.py
python tests/test_ml_analysis.py
```

### ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤

Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã¨Docker Hubã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:

```bash
# scriptsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
python scripts/build_and_push.py --username YOUR_USERNAME

# è©³ç´°ã¯ scripts/README_BUILD.md ã‚’å‚ç…§
```

## å‚è€ƒãƒªãƒ³ã‚¯

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [llama-cpp-python](https://github.com/abetlen/llama-cpp-python)
- [music21 Documentation](http://web.mit.edu/music21/)
- [Kaggle Docker Images](https://github.com/Kaggle/docker-python)
- [YuE Model](https://huggingface.co/Aryanne/YuE-s1-7B-anneal-en-cot-Q6_K-GGUF)
- [rinna Models](https://huggingface.co/rinna)

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ã¯å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«å¾“ã„ã¾ã™ã€‚

